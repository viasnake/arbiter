[tools]
rust = "stable"

[tasks.fmt]
description = "Format Rust code"
run = "cargo fmt --all"

[tasks.fmt-check]
description = "Check Rust formatting"
run = "cargo fmt --all --check"

[tasks.lint]
description = "Run clippy with warnings denied"
run = "cargo clippy --workspace --all-targets -- -D warnings"

[tasks.test]
description = "Run workspace tests"
run = "cargo test --workspace"

[tasks.contracts-verify]
description = "Verify OpenAPI and contract schema linkage"
run = "cargo test -p arbiter-contracts"

[tasks.drift-guard]
description = "Guard OpenAPI refs and schema compilation drift"
run = "cargo test -p arbiter-contracts"

[tasks.version-check]
description = "Verify release version consistency across source files"
run = "python3 scripts/version.py check"

[tasks.version-bump]
description = "Update release version across source files (set VERSION=x.y.z)"
run = "python3 scripts/version.py bump ${VERSION:?set VERSION=x.y.z}"

[tasks.build]
description = "Build release binary"
run = "cargo build --release"

[tasks.ci]
description = "Run full local CI pipeline"
depends = ["version-check", "fmt-check", "lint", "drift-guard", "contracts-verify", "test", "build"]
