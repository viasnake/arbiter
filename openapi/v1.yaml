openapi: 3.1.0
info:
  title: Arbiter API
  version: 1.0.0
servers:
  - url: http://localhost:8080
paths:
  /v1/healthz:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema: { type: string }

  /v1/contracts:
    get:
      summary: Contracts metadata (versions, action registry)
      responses:
        "200":
          description: Metadata
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /v1/events:
    post:
      summary: Submit Event
      description: Returns a deterministic ResponsePlan. Gate/AuthZ denials are represented as do_nothing action.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/Event" }
      responses:
        "200":
          description: ResponsePlan
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ResponsePlan" }
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /v1/generations:
    post:
      summary: Submit GenerationResult
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/GenerationResult" }
      responses:
        "200":
          description: ResponsePlan
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ResponsePlan" }
        "400":
          description: Invalid request payload
          content:
            application/json:
                schema: { $ref: "#/components/schemas/Error" }

  /v1/job-events:
    post:
      summary: Submit job lifecycle status event
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/JobStatusEvent" }
      responses:
        "200":
          description: ResponsePlan
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ResponsePlan" }
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /v1/job-cancel:
    post:
      summary: Submit job cancellation request event
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/JobCancelRequest" }
      responses:
        "200":
          description: ResponsePlan
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ResponsePlan" }
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /v1/approval-events:
    post:
      summary: Submit approval workflow event
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ApprovalEvent" }
      responses:
        "200":
          description: ResponsePlan
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ResponsePlan" }
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /v1/action-results:
    post:
      summary: Report action execution result (action execution result reporting)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ActionResult" }
      responses:
        "204":
          description: No Content
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

components:
  schemas:
    Event: { $ref: "../contracts/v1/event.schema.json" }
    Action: { $ref: "../contracts/v1/action.schema.json" }
    ResponsePlan: { $ref: "../contracts/v1/response_plan.schema.json" }
    GenerationResult: { $ref: "../contracts/v1/generation_result.schema.json" }
    JobStatusEvent: { $ref: "../contracts/v1/job_status_event.schema.json" }
    JobCancelRequest: { $ref: "../contracts/v1/job_cancel_request.schema.json" }
    ApprovalEvent: { $ref: "../contracts/v1/approval_event.schema.json" }
    ActionResult: { $ref: "../contracts/v1/action_result.schema.json" }

    Error:
      type: object
      additionalProperties: false
      required: [error]
      properties:
        error:
          type: object
          additionalProperties: false
          required: [code, message]
          properties:
            code: { type: string }
            message: { type: string }
