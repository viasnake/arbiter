# Arbiter v1.1.1 Scope

## Scope

Arbiter v1.1.1 is a patch release focused on idempotency safety and startup validation consistency.

- `POST /v1/events` now detects duplicate key payload mismatches and returns `409 conflict.payload_mismatch`.
- `build_app` now rejects unsupported `store.kind` values in all paths with `config.invalid_store_kind`.
- Event idempotency behavior is documented in `docs/state/events.md`.
- API error code catalog is documented in `docs/errors.md`.

## Invariants

- Event idempotency key remains `(tenant_id, event_id)`.
- Duplicate events with identical payload return the existing `ResponsePlan`.
- Duplicate events with different payload fail explicitly (`409`) instead of being accepted silently.
- Audit remains append-only and hash-chained (`prev_hash`, `record_hash`).

## Non-goals

- No public contract version bump (`v=1` remains unchanged).
- No new execution capabilities.
- No architecture changes to decision stages.

## API surface impacted

- `POST /v1/events` (duplicate conflict diagnostics hardened)

## Migration notes

- Existing clients remain compatible with v1 contracts.
- Retry logic should handle `409 conflict.payload_mismatch` as a non-retriable conflict for the same idempotency key.

## Acceptance checklist

- [x] Duplicate `(tenant_id, event_id)` with mismatched payload returns `409`.
- [x] Invalid `store.kind` fails startup for both CLI and library path.
- [x] Docs updated for event state semantics and API error codes.
- [x] Local CI-equivalent gates pass (`mise run ci`).

## Release process notes

- Keep changes in small Conventional Commit units.
- Verify version consistency before tagging (`Cargo.toml` and `openapi/v1.yaml` are `1.1.1`).
- Publish by pushing tag `v1.1.1`.
